datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Parent {
  id        Int       @id @default(autoincrement())
  firstName String
  lastName  String
  phone     String?
  email     String?
  students  Student[]
}

model Student {
  id          Int       @id @default(autoincrement())
  firstName   String
  lastName    String
  classLevel  String
  branch      String?
  parent      Parent?   @relation(fields: [parentId], references: [id])
  parentId    Int?
  createdAt   DateTime  @default(now())
}

model SuccessStory {
  id        Int      @id @default(autoincrement())
  name      String               // Ã–ÄŸrenci (baÅŸ harfleri de olabilir)
  year      Int                  // YerleÅŸtiÄŸi yÄ±l
  uni       String               // Ãœniversite adÄ±
  dept      String               // BÃ¶lÃ¼m adÄ±
  photoUrl      String?
  photoPublicId String?
  detail    String?              // DetaylÄ± hikÃ¢ye / aÃ§Ä±klama
  slug      String? @unique      // Ä°leride /basari/slug iÃ§in
  isFeatured Boolean @default(true)
  priority  Int      @default(0) // SÄ±ralama
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  branchId Int
  branch   Branch @relation(fields: [branchId], references: [id])  
}

model Branch {
  id        Int      @id @default(autoincrement())
  name      String
  slug      String   @unique
  address   String?
  phone     String?
  instagram String?
  facebook  String?
  whatsapp  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  mapEmbedUrl  String?   // ðŸ”´ Yeni alan: Harita iframe src'si

  announcements  Announcement[]
  staff          Staff[]
  successStories SuccessStory[]
  sliderItems    SliderItem[]

}

model Staff {
  id        Int      @id @default(autoincrement())
  name      String
  branch    String
  role      String?
  photoUrl  String?
  photoPublicId String? 

  cvUrl     String?
  cvPublicId String? 

  bio       String?
  priority  Int      @default(0)
  isActive  Boolean  @default(true)
  isFounder Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  branchId Int
  branchRel Branch @relation(fields: [branchId], references: [id])
}


model Announcement {
  id          Int       @id @default(autoincrement())
  title       String
  slug        String    @unique
  summary     String?   // ðŸ”¹ Kartlarda kullanabileceÄŸimiz kÄ±sa Ã¶zet
  content     String    // HTML (rich text)
  audience    String?   // "genel" | "veli" | "ogrenci" gibi
  coverImageUrl  String?   // ðŸ”¹ Kart / detay iÃ§in kapak gÃ¶rseli URL
  coverImagePublicId String?  
  isPublished Boolean   @default(false)
  publishAt   DateTime? // ðŸ”¹ PlanlÄ± yayÄ±n tarihi (boÅŸsa hemen)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  branchId Int
  branch   Branch @relation(fields: [branchId], references: [id])  
}

model ExamApplication {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  fullName  String
  grade     String
  phone     String
  email     String?
  notes     String?

  kvkk      Boolean  @default(false)
  kvkkAt    DateTime?

  status    String   @default("new") // new, called, registered, cancelled...
  adminNote String?

  @@index([createdAt])
  @@index([status])
}

model Testimonial {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  approvedAt DateTime?

  type      String   // "student" | "parent"
  fullName  String
  grade     String?  // Ã¶ÄŸrenci ise
  childName String?  // veli ise (opsiyonel)
  phone     String?  // opsiyonel (admin iÃ§in)
  email     String?  // opsiyonel (admin iÃ§in)
  message   String

  approved  Boolean  @default(false)

  @@index([approved, createdAt])
}


model SliderItem {
  id        Int      @id @default(autoincrement())
  title     String?
  linkUrl   String?   // tÄ±klayÄ±nca gideceÄŸi yer (duyuru, form, dÄ±ÅŸ link)
  imageUrl  String
  imagePublicId String?
  isActive  Boolean  @default(true)
  priority  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  branchId Int
  branch   Branch @relation(fields: [branchId], references: [id]) 
}

model SpecialPopup {
  id            Int      @id @default(autoincrement())
  title         String?
  description   String?
  imageUrl      String
  imagePublicId String?

  isActive      Boolean  @default(false)
  startAt       DateTime?
  endAt         DateTime?

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}
