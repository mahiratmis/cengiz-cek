datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}




model Parent {
  id        Int       @id @default(autoincrement())
  firstName String
  lastName  String
  phone     String?
  email     String?
  students  Student[]
}

model Student {
  id          Int       @id @default(autoincrement())
  firstName   String
  lastName    String
  classLevel  String
  branch      String?
  parent      Parent?   @relation(fields: [parentId], references: [id])
  parentId    Int?
  createdAt   DateTime  @default(now())
}



model SuccessStory {
  id        Int      @id @default(autoincrement())
  name      String               // Ã–ÄŸrenci (baÅŸ harfleri de olabilir)
  year      Int                  // YerleÅŸtiÄŸi yÄ±l
  uni       String               // Ãœniversite adÄ±
  dept      String               // BÃ¶lÃ¼m adÄ±
  photoUrl  String?              // Ã–ÄŸrenci fotoÄŸrafÄ±
  detail    String?              // DetaylÄ± hikÃ¢ye / aÃ§Ä±klama
  slug      String? @unique      // Ä°leride /basari/slug iÃ§in
  isFeatured Boolean @default(true)
  priority  Int      @default(0) // SÄ±ralama
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  branchId Int
  branch   Branch @relation(fields: [branchId], references: [id])  
}

model Branch {
  id        Int      @id @default(autoincrement())
  name      String
  slug      String   @unique
  address   String?
  phone     String?
  instagram String?
  facebook  String?
  whatsapp  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  mapEmbedUrl  String?   // ğŸ”´ Yeni alan: Harita iframe src'si

  announcements  Announcement[]
  staff          Staff[]
  successStories SuccessStory[]
}

model Staff {
  id        Int      @id @default(autoincrement())
  name      String
  branch    String
  role      String?      // Ã–rn: "Matematik Ã–ÄŸretmeni", "Rehber Ã–ÄŸretmen"
  photoUrl  String?      // Kadro fotoÄŸrafÄ±
  cvUrl    String?      // Ã–zgeÃ§miÅŸ PDF URL
  bio       String?      // KÄ±sa tanÄ±tÄ±m yazÄ±sÄ±
  priority  Int      @default(0) // SÄ±ralama iÃ§in
  isActive  Boolean  @default(true)
  isFounder  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  branchId Int
  branchRel Branch @relation(fields: [branchId], references: [id]) // â† isim Ã§akÄ±ÅŸmasÄ±n diye branchRel
}

model Announcement {
  id          Int       @id @default(autoincrement())
  title       String
  slug        String    @unique
  summary     String?   // ğŸ”¹ Kartlarda kullanabileceÄŸimiz kÄ±sa Ã¶zet
  content     String    // HTML (rich text)
  audience    String?   // "genel" | "veli" | "ogrenci" gibi
  coverImage  String?   // ğŸ”¹ Kart / detay iÃ§in kapak gÃ¶rseli URL
  isPublished Boolean   @default(false)
  publishAt   DateTime? // ğŸ”¹ PlanlÄ± yayÄ±n tarihi (boÅŸsa hemen)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  branchId Int
  branch   Branch @relation(fields: [branchId], references: [id])  
}

model ExamApplication {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  fullName  String
  grade     String
  phone     String
  email     String?
  notes     String?

  kvkk      Boolean  @default(false)
  kvkkAt    DateTime?

  status    String   @default("new") // new, called, registered, cancelled...
  adminNote String?

  @@index([createdAt])
  @@index([status])
}

model Testimonial {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  approvedAt DateTime?

  type      String   // "student" | "parent"
  fullName  String
  grade     String?  // Ã¶ÄŸrenci ise
  childName String?  // veli ise (opsiyonel)
  phone     String?  // opsiyonel (admin iÃ§in)
  email     String?  // opsiyonel (admin iÃ§in)
  message   String

  approved  Boolean  @default(false)

  @@index([approved, createdAt])
}
